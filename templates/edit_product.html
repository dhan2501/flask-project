{% extends "base.html" %}
{% block title %}Edit Product{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        {% include 'sidebar.html' %}
    </div>
    <div class="col-md-9">
        <h2>Edit Product</h2>
        <form method="POST" enctype="multipart/form-data" class="mt-3">

            <div class="mb-3">
                <label for="name" class="form-label">Product Name</label>
                <input value="{{ product.name }}" type="text" name="name" id="name" class="form-control" required>
            </div>

            <div class="mb-3">
                <label for="slug" class="form-label">Slug</label>
                <input value="{{ product.slug }}" type="text" name="slug" id="slug" class="form-control" placeholder="Will be auto-generated if empty">
            </div>

            <div class="mb-3">
                <label for="regular_price" class="form-label">Regular Price</label>
                <input value="{{ product.regular_price }}" type="number" step="0.01" name="regular_price" id="regular_price" class="form-control" required>
            </div>

            <div class="mb-3">
                <label for="sale_price" class="form-label">Sale Price</label>
                <input value="{{ product.sale_price or '' }}" type="number" step="0.01" name="sale_price" id="sale_price" class="form-control">
            </div>

            <div class="mb-3">
                <label for="short_description" class="form-label">Short Description</label>
                <input value="{{ product.short_description or '' }}" type="text" name="short_description" id="short_description" class="form-control">
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea name="description" id="description" class="form-control" rows="4">{{ product.description or '' }}</textarea>
            </div>

            <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select name="category" id="category" class="form-select" required>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if product.category and product.category.id == category.id %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <label class="form-label">Tags</label>
            <div class="mb-3">
                {% for tag in tags %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="tags" id="tag{{ tag.id }}" value="{{ tag.id }}" {% if tag in product.tags %}checked{% endif %}>
                    <label class="form-check-label" for="tag{{ tag.id }}">{{ tag.name }}</label>
                </div>
                {% endfor %}
            </div>

            <hr>
            <h4>Images & Schema</h4>

            <div class="mb-3">
                <label for="product_image" class="form-label">Main Product Image</label>
                <input type="file" name="product_image" id="product_image" class="form-control" accept="image/*">
                {% if product.product_image %}
                <img src="{{ product.product_image }}" alt="Main Image" class="img-thumbnail mt-2" style="max-height: 150px;">
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="gallery_images" class="form-label">Gallery Images</label>
                <input type="file" name="gallery_images" id="gallery_images" class="form-control" accept="image/*" multiple>
                <small class="form-text text-muted">Select multiple images for the product gallery.</small>
                <div class="mt-2">
                    {% for gallery in product.gallery_images %}
                    <img src="{{ gallery.image_url }}" alt="Gallery Image" class="img-thumbnail me-2" style="max-height: 100px;">
                    {% endfor %}
                </div>
            </div>

            <div class="mb-3">
                <label for="schema_json" class="form-label">Product Schema (JSON)</label>
                <textarea name="schema_json" id="schema_json" class="form-control" rows="6">{% if product.schemas.first() %}{{ product.schemas.first().schema_json }}{% endif %}</textarea>
                <small class="form-text text-muted">Optional rich snippet or structured data in JSON format.</small>
            </div>

            <hr>
            <h4>SEO & Social Metadata</h4>

            <div class="mb-3">
                <label for="meta_title" class="form-label">Meta Title</label>
                <input value="{{ product.meta_title or '' }}" type="text" name="meta_title" id="meta_title" class="form-control">
            </div>

            <div class="mb-3">
                <label for="meta_description" class="form-label">Meta Description</label>
                <textarea name="meta_description" id="meta_description" class="form-control" rows="3">{{ product.meta_description or '' }}</textarea>
            </div>

            <div class="mb-3">
                <label for="twitter_title" class="form-label">Twitter Title</label>
                <input value="{{ product.twitter_title or '' }}" type="text" name="twitter_title" id="twitter_title" class="form-control">
            </div>

            <div class="mb-3">
                <label for="twitter_description" class="form-label">Twitter Description</label>
                <textarea name="twitter_description" id="twitter_description" class="form-control" rows="3">{{ product.twitter_description or '' }}</textarea>
            </div>

            <div class="mb-3">
                <label for="og_title" class="form-label">Open Graph (OG) Title</label>
                <input value="{{ product.og_title or '' }}" type="text" name="og_title" id="og_title" class="form-control">
            </div>

            <div class="mb-3">
                <label for="og_description" class="form-label">Open Graph (OG) Description</label>
                <textarea name="og_description" id="og_description" class="form-control" rows="3">{{ product.og_description or '' }}</textarea>
            </div>

            <button type="submit" class="btn btn-primary">Update</button>
            <a href="{{ url_for('product_list') }}" class="btn btn-secondary ms-2">Cancel</a>
        </form>
    </div>
</div>
{% endblock %}
